<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Prepare a Blazor Project. </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Prepare a Blazor Project. ">
    <meta name="generator" content="docfx 2.56.1.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="prepare-a-blazor-project">Prepare a Blazor Project.</h1>

<p>We start preparations by generating a new Blazor WebAssembly Project from Visual Studio.
Make sure you have the WebAssembly Templates installed by following the <a href="https://docs.microsoft.com/en-us/aspnet/core/blazor/get-started?view=aspnetcore-3.1&amp;tabs=visual-studio">instructions in the
documentation</a>.</p>
<blockquote>
<p>We will use a WebAssembly Project for these preparations, but the steps for Server Side
Blazor are roughly the same.</p>
</blockquote>
<p>Create a new project using the settings below:</p>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_createpage-1" role="tab" aria-controls="tabpanel_CeZOj-G++Q_createpage-1" data-tab="createpage-1" tabindex="0" aria-selected="true">Create Page 1</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_createpage-2" role="tab" aria-controls="tabpanel_CeZOj-G++Q_createpage-2" data-tab="createpage-2" tabindex="-1">Create Page 2</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q_createpage-3" role="tab" aria-controls="tabpanel_CeZOj-G++Q_createpage-3" data-tab="createpage-3" tabindex="-1">Create Page 3</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q_createpage-1" role="tabpanel" data-tab="createpage-1">

<p><img src="../images/newproject1.png" alt="New Project, Page 1"></p>
</section>
<section id="tabpanel_CeZOj-G++Q_createpage-2" role="tabpanel" data-tab="createpage-2" aria-hidden="true" hidden="hidden">

<p><img src="../images/newproject2.png" alt="New Project, Page 2"></p>
</section>
<section id="tabpanel_CeZOj-G++Q_createpage-3" role="tabpanel" data-tab="createpage-3" aria-hidden="true" hidden="hidden">

<p><img src="../images/newproject3.png" alt="New Project, Page 3"></p>
</section>
</div>
<h2 id="add-a-shared-rcl-project">Add a Shared RCL Project.</h2>
<p>To prepare a Blazor Project for use with a BlazorWebView it is best to move all dynamic
Blazor content to a Razor Class Library, and keep only the static content inside the
WebAssembly Project. We do this by adding a new project to the solution first:</p>
<div class="tabGroup" id="tabgroup_CeZOj-G++Q-1">
<ul role="tablist">
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-1_addpage-1" role="tab" aria-controls="tabpanel_CeZOj-G++Q-1_addpage-1" data-tab="addpage-1" tabindex="0" aria-selected="true">Add Project 1</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-1_addpage-2" role="tab" aria-controls="tabpanel_CeZOj-G++Q-1_addpage-2" data-tab="addpage-2" tabindex="-1">Add Project 2</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-1_addpage-3" role="tab" aria-controls="tabpanel_CeZOj-G++Q-1_addpage-3" data-tab="addpage-3" tabindex="-1">Add Project 3</a>
</li>
<li role="presentation">
<a href="#tabpanel_CeZOj-G++Q-1_addpage-4" role="tab" aria-controls="tabpanel_CeZOj-G++Q-1_addpage-4" data-tab="addpage-4" tabindex="-1">Add Project 4</a>
</li>
</ul>
<section id="tabpanel_CeZOj-G++Q-1_addpage-1" role="tabpanel" data-tab="addpage-1">

<p><img src="../images/addnewproject1.png" alt="Add New Project, Page 1"></p>
</section>
<section id="tabpanel_CeZOj-G++Q-1_addpage-2" role="tabpanel" data-tab="addpage-2" aria-hidden="true" hidden="hidden">

<p><img src="../images/addnewproject2.png" alt="Add New Project, Page 2"></p>
</section>
<section id="tabpanel_CeZOj-G++Q-1_addpage-3" role="tabpanel" data-tab="addpage-3" aria-hidden="true" hidden="hidden">

<p><img src="../images/addnewproject3.png" alt="Add New Project, Page 3"></p>
</section>
<section id="tabpanel_CeZOj-G++Q-1_addpage-4" role="tabpanel" data-tab="addpage-4" aria-hidden="true" hidden="hidden">

<p><img src="../images/addnewproject4.png" alt="Add New Project, Page 4"></p>
</section>
</div>

<p>Do not tick the option to support Pages and Views, as this is for Razor Pages, a
server-side technology that has nothing to do with Blazor.
We can delete all content that has been generated as an example in the RCL Project,
as we will move over the content from the WebAssembly Project shortly. Don't delete
the wwwroot folder itself, we will use that later on.</p>
<p>Finally add a reference from the WebAssembly Project to the RCL Project:</p>
<ul>
<li>Right-click <code>Dependencies</code> node in the solution explorer of the WebAssembly Project.</li>
<li>Select <code>Add reference...</code></li>
<li>In the dialog that is opened, click <code>Projects</code> and <code>Solution</code>.</li>
<li>Select your shared RCL Project.</li>
</ul>
<h2 id="move-over-the-necessary-files-and-folders">Move over the Necessary Files and Folders.</h2>
<p>Now move over the following items from the WebAssembly project to the shared RCL Project,
leaving only the favicon.ico and index.html files in the wwwroot behind:</p>
<ul>
<li>Pages</li>
<li>Shared</li>
<li>_Imports.razor</li>
<li>App.razor</li>
<li>wwwroot/css</li>
<li>wwwroot/sample-data</li>
</ul>
<p>You'll arrive at the following structure:</p>
<p><img src="../images/finalstructure.png" alt="Final structure"></p>
<h2 id="clean-up-the-build-errors">Clean up the Build Errors.</h2>
<p>Now build your solution. You'll get a list of build errors that need to be addressed:</p>
<p><img src="../images/builderrors.png" alt="build errors"></p>
<p>We will fix these one by one:</p>
<ul>
<li>First, we change the namespaces in <code>_Imports.Razor</code> to match the shared library instead of
the WebAssembly Project:</li>
</ul>
<pre><code class="lang-cshtml-razor">@using System.Net.Http
@using Microsoft.AspNetCore.Components.Forms
@using Microsoft.AspNetCore.Components.Routing
@using Microsoft.AspNetCore.Components.Web
@using Microsoft.JSInterop
&lt;!-- change these last two lines to match the namespaces of your shared library !--&gt;
@using BlazorWebViewTutorial.Shared
@using BlazorWebViewTutorial.Shared.Shared
</code></pre>
<ul>
<li>Next, add a NuGet reference to <code>Microsoft.AspNetCore.Blazor.HttpClient</code> to the shared project
as well (It is already in the webassembly project).</li>
<li>Now we have to change the <code>App.Razor</code> file in the shared project to point to the right AppAssembly,
because <code>Program</code> lives in the WebAssembly project, so change <code>Program</code> into <code>App</code>:</li>
</ul>
<pre><code class="lang-cshtml-razor">&lt;Router AppAssembly=&quot;@typeof(App).Assembly&quot;&gt;
    &lt;Found Context=&quot;routeData&quot;&gt;
        &lt;RouteView RouteData=&quot;@routeData&quot; DefaultLayout=&quot;@typeof(MainLayout)&quot; /&gt;
    &lt;/Found&gt;
    &lt;NotFound&gt;
        &lt;LayoutView Layout=&quot;@typeof(MainLayout)&quot;&gt;
            &lt;p&gt;Sorry, there's nothing at this address.&lt;/p&gt;
        &lt;/LayoutView&gt;
    &lt;/NotFound&gt;
&lt;/Router&gt;
</code></pre>
<ul>
<li>Finally, we add a using statement to the <code>Program.cs</code> folder in the WebAssembly project to
resolve the App class at a new location:</li>
</ul>
<pre><code class="lang-csharp">using System;
using System.Collections.Generic;
using System.Threading.Tasks;
using System.Text;
using Microsoft.AspNetCore.Components.WebAssembly.Hosting;
using Microsoft.Extensions.DependencyInjection;

// Add this line and have it match the location of the App class.
using BlazorWebViewTutorial.Shared;

namespace BlazorWebViewTutorial.Client
{
    public class Program
    {
        public static async Task Main(string[] args)
        {
            var builder = WebAssemblyHostBuilder.CreateDefault(args);
            builder.RootComponents.Add&lt;App&gt;(&quot;app&quot;);

            builder.Services.AddBaseAddressHttpClient();

            await builder.Build().RunAsync();
        }
    }
}
</code></pre>
<p>The project should now build without any errors. Let's move on and try to run it:</p>
<h2 id="solve-some-runtime-problems">Solve Some Runtime Problems.</h2>
<p>Click Debug or press F5 to build and run the project. A browser page will open that looks like this:</p>
<p><img src="../images/browsererror.png" alt="browser error"></p>
<p>This is because the files we have moved from the WebAssembly wwwroot folder to the Shared RCL Project
wwwroot folder cannot be loaded from the location where they were before. These items are called
<a href="https://docs.microsoft.com/en-us/aspnet/core/razor-pages/ui-class?view=aspnetcore-3.1&amp;tabs=visual-studio#create-an-rcl-with-static-assets">Static Assets</a>
and they are loaded from a special location by Blazor.</p>
<blockquote>
<p>The files included in the wwwroot folder of the RCL are exposed to either the RCL or the consuming
app under the prefix _content/{LIBRARY NAME}/. For example, a library named Razor.Class.Lib results
in a path to static content at _content/Razor.Class.Lib/.
When producing a NuGet package and the assembly name isn't the same as the package ID, use the
package ID for {LIBRARY NAME}.</p>
</blockquote>
<p>This is why Blazor WebAssembly cannot find them. The easiest way to solve this, is by editing
the index.html file in the WebAssembly project. Make sure it looks like the listing below:</p>
<pre><code class="lang-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;

&lt;head&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;
    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;
    &lt;title&gt;BlazorWebViewTutorial.Client&lt;/title&gt;
    &lt;base href=&quot;/&quot; /&gt;
    &lt;!-- Add _content/BlazorWebViewTutorial.Shared below --&gt;
    &lt;link href=&quot;_content/BlazorWebViewTutorial.Shared/css/bootstrap/bootstrap.min.css&quot; rel=&quot;stylesheet&quot; /&gt;
    &lt;link href=&quot;_content/BlazorWebViewTutorial.Shared/css/site.css&quot; rel=&quot;stylesheet&quot; /&gt;
&lt;/head&gt;

&lt;body&gt;
    &lt;app&gt;Loading...&lt;/app&gt;

    &lt;div id=&quot;blazor-error-ui&quot;&gt;
        An unhandled error has occurred.
        &lt;a href=&quot;&quot; class=&quot;reload&quot;&gt;Reload&lt;/a&gt;
        &lt;a class=&quot;dismiss&quot;&gt;🗙&lt;/a&gt;
    &lt;/div&gt;
    &lt;script src=&quot;_framework/blazor.webassembly.js&quot;&gt;&lt;/script&gt;
&lt;/body&gt;

&lt;/html&gt;
</code></pre>
<h2 id="fetch-the-sample-data-from-the-right-location">Fetch the Sample Data from the Right Location.</h2>
<p>The sample data is in the razor class library too, so we should alter the URL where the <code>FetchData.razor</code> page
gets its sample data from. Alter the <code>OnInitializedAsync</code> method to read like this:</p>
<pre><code class="lang-csharp">    protected override async Task OnInitializedAsync()
    {
        forecasts = await Http.GetJsonAsync&lt;WeatherForecast[]&gt;(&quot;_content/BlazorWebViewTutorial.Shared/sample-data/weather.json&quot;);
    }
</code></pre>
<p>Press F5 again. The project should now build, run and the sample should be in working order.
Congratulations! You've completed the preparations and are ready to move on to one of the
tutorials. The source code so far is in this branch:</p>
<p><a href="https://github.com/jspuij/BlazorWebViewTutorial/tree/1_prepare">https://github.com/jspuij/BlazorWebViewTutorial/tree/1_prepare</a></p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <div class="contribution">
                <ul class="nav">
                  <li>
                    <a href="https://github.com/jspuij/TwokaB/blob/master/docs/pages/prepare.md/#L1" class="contribution-link">Improve this Doc</a>
                  </li>
                </ul>
              </div>
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
            
            <span>Generated by <strong>DocFX</strong></span>
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
